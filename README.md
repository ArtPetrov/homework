Увидев состав проверочной работы, было принято решение разделить задачи на:
- "рутинные", могут повторяться изо дня в день и их **нужно автоматизировать**; 
- "интересные" задачи, которые не поддаются _базовой автоматизации_ или требуют творческого подхода;

Для автоматизации "рутинных" задач, мой выбор пал на **Ansible** без использования Galaxy репозитория. (давно хотел освежить память до актуальной версии)

**hosts.yml** - содержит два хоста **root_access**(прислал клиент) и **devops_access** (для развертывания ПО)

После знакомства с дрополетом, он оказался **Centos 7** c 1GB RAM на борту. Я создал себе sudo-пользователя запустив подготовительный рецепт:
```
ansible-playbook prepare.yml -i hosts.yml 
```

Далее мной был создан файл конфигураций **config.yml**, в котором описал основные переменные для автоматического развертывания всех задач. 
Перехожу к написанию рецепта, рутинные задачи: 
_Установить nginx, Установить php, Соединить nginx+php-fpm, Установить memcached, Настроить сессию в php через memcached, Создать VirtualHost и папку по заданному домену, Получить  SSL сертификат для заданного домена, Установить mysql, Расположить код WordPress в директории для заданного домена, Создать аккаунт разработчика для правки кода в директории_

Выполняем команду по борьбе с рутиной и переходим к разбору решений:
```
ansible-playbook playbook.yml -i hosts.yml
```

``` 1. Установить Nginx и PHP-FPM. Создать виртуальный хост test9.do.-.ru (по названию дроплета) ``` 
<details>
  <summary>Пояснение</summary>

Фраза "по названию дроплета" подвигнула написать роль, которая будет или автоматически вытаскивать hostname с дроплета или брать его из переменной. Все остальное тривиально.
</details>

``` 2. Настроить SSL. ```
<details>
  <summary>Пояснение</summary>

Здесь на помощь приходит Certbot с самоподписывающимся сертификатам. (в crontab все добавлено)
</details>

``` 3. Разместить в каталог с кодом WordPress и дать доступ разработчикам для правки кода (метод правки выбрать на ваше усмотрение, кроме админки WordPress). ```
<details>
  <summary>Пояснение</summary>

Для выполнения задачи по правкам кода было решено использовать **sftp**, реализовать без использования сторонних компонентов можно через монтирование папок(создавая группы и пользователей) или просто через назначения **owner - аккаунт разработчика**, а для **группы nginx** повысить привилегии до 7.

Плюсы метода через монтирование, можно более гибко управлять доступом, создавая несколько аккаунтов и групп для разделения отвественности.
Но так как в задачи не было такой цели, я выбрал более легкий способ в реализации через owner. 

_P.S. Так же были мысли, если разработчик что-то испортит и у него не будет возможности оперативно вернуть в исходное состояние, сделать спасательный круг. 
Например, вести две директории prod и dev, разработчик будет иметь доступ только к dev, а prod будет автоматически синхронизироваться с задержкой N часов. Когда возникает ситуация, что dev не может вернуться к стабильной работе. 
Нужно создать пустой файл HELP и сервис автоматически сменит symlink проекта на prod версию, а как только этот файл удалят, то symlink снова на dev версию вернется.
Но это мысли в слух только._

</details>

``` 4. Установить memcached и настроить хранение php-сессий в memcached. ```
<details>
  <summary>Пояснение</summary>

Memcache настроил через SOCK. В пределах одной машины мне показалось более рациональное использования, чем TCP. 

_P.S. При выполнении playbook на экзаменационной машине, служба не смогла запуститься(на тестовом таких проблем не было). Пришлось руками разбираться в чем дело и редактировать unit-файла memcached._
</details>

``` 5. Средствами nginx сделать перенаправление с www на без-www (чтобы www.test9.do.-.ru переадресовывался в test9.do.-.ru). ```
<details>
  <summary>Пояснение</summary>

Так, как это является типовой задачей, то редирект реализован в ролях "Получения SSL" и "Установка WordPress". Роли не являются атомарными, поэтому дублирования редиректов в шаблонах неопасно.
</details>

``` 6. Для WordPress нужна база данных, установите ее. Создайте в ней пользователя с доступом "только на чтение". Настройки СУБД нужно оптимизировать под максимальную производительность на данном сервере. ```
<details>
  <summary>Описание этапов выполнения задания </summary>

1) После установки **mysql**, получаем временный пароль **root** от БД:
```shell
sudo grep 'temporary password' /var/log/mysqld.log
```
2) Выполняем сценарий: **mysql_secure_installation**
3)   ```> mysql -u root -p``` и выполняем следующий код:
```sql
CREATE DATABASE slurm;
CREATE USER 'slurm'@'localhost' IDENTIFIED BY 'Slurm123456!';
GRANT SELECT ON slurm.* TO 'slurm'@'localhost';
FLUSH PRIVILEGES;
```

4) Для проведения оптимизации на сервере будем использовать утилиту **mysqltuner**
```shell
sudo yum -y install mysqltuner
mysqltuner --user root --pass PASSWORD_ROOT
```

5) Внимательно изучаем секцию **Variables to adjust** и переходим к конфигурированию: ```/etc/my.cnf```
6) Типовые настройки для **InnoDB** будут следующие: 
```yaml
   innodb_buffer_pool_size = 70% от общего количество свободного RAM когда все приложения взяли своё (для машин > 4GB RAM, иначе проценты ниже) 
   innodb_log_file_size    = 25% от innodb_buffer_pool_size (mysqltuner порекомендует более точно)
   key_buffer_size = 8M, главное не 0
   tmp_table_size = 32M начинаем обычно с этого значения и наблюдаем за Created_tmp_disk_tables, далее корректируем
   max_heap_table_size = если не используются таблицы типа MEMORY то значение равное tmp_table_size
```
7) Сохраняем изменения, делаем ```sudo systemctl restart mysqld``` и затем снова повторяем **mysqltuner** и снова анализируем. 
8) Для более эффективной настройки рекомендуется постоянно анализировать. Но не стоит и забывать про оптимизацию самой БД на уровне запросов и приложения.

``` Внимание! Пользователь имеет права только на чтение, установка WordPress не будет завершена в автоматическом режиме! (можно залить дамп или создать ещё пользователя)  ```
</details>

``` 7*. Задание со звездочкой (подумать и описать): настроить сервер и ПО на нем с учетом требований безопасности, чтобы можно было этот проект передать заказчику. Проверьте чтобы ваше подключение SSL было безопасным через SSLlabs. ```
<details>
  <summary>Решение</summary>

```
- Первым делом я порекомендовал заказчику отказаться от классической авторизации по паролю в пользу ssh-ключей. 
- На всякий случай проверил бы все перед сдачей **Lynis**
- Провел анализ открытых портов и уточнил, какие действительно нужно держать открытыми, а какие можно и закрыть.(у нас сейчас порт для БД и SMPT открыты)
- P.S Возможно не относится к безопасности в условиях текущей задачи. Но метрики и алерты никогда не бывают лишними.

SSL через https://www.ssllabs.com проверил - Overall Rating: A
```

</details>

``` 8*. Задание со звездочкой (подумать и описать): как можно организовать отказоустойчивость вашему проекту? ```
<details>
  <summary>Решение</summary>

```
Для начала нужно найти/предугодать бутылочные горлышки в системе. Можно использовать для этого системы нагрузочного тестирования(про метрики уже писал в 7 вопросе).
Например в текущем проекте первое слабое место, это стоковый настройки nginx. (он конечно же хорош, но может и лучше при грамотной конфигурации)
Слышал, что WordPress страдает утечкой памяти, значит нужно поработать в этом направлении с php-fpm.(почитать материал по этой теме)

Если проект подвержен постоянным DDoS-атакам, то следует воспользоваться услугами по защите от DDoS-атак (если своими силами её не отразить).

На самом деле тема очень холиварная и надеюсь '*' в вопросе означает не сложность, а свободную форму изложения мыслей. 
Для повышения отказоустойчивость нужен комплекс мер по организации проекта. 

P.S Именно с архитектурной точки зрения, такой вопрос был на вступительных задачах.

```
</details>


